{% extends "core/base.html" %}
{% block content %}
<div class="container py-4">

    <h2 class="mb-4">Report Moderation Center</h2>

    <!-- FILTER BUTTONS -->
    <div class="mb-3">
        <a href="?status=all" class="btn btn-sm {% if current_filter == 'all' %}btn-primary{% else %}btn-outline-primary{% endif %}">All</a>

        {% for status in valid_statuses %}
            <a href="?status={{ status }}" class="btn btn-sm {% if current_filter == status %}btn-primary{% else %}btn-outline-primary{% endif %}">
                {{ status|title }}
            </a>
        {% endfor %}
    </div>

    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>Item</th>
                <th>Image</th>
                <th>Reason</th>
                <th>Reporter</th>
                <th>Status</th>
                <th style="width: 180px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr>
                <td>
                    <a href="{% url 'item_detail' report.item.pk %}">
                        {{ report.item.title }}
                    </a>
                </td>

                <td>
                    {% if report.item.image %}
                        <img src="{{ report.item.image.url }}" width="70" class="img-thumbnail">
                    {% else %}
                        <span class="text-muted">No image</span>
                    {% endif %}
                </td>

                <td>{{ report.reason }}</td>

                <td>
                    {% if report.reported_by %}
                        {{ report.reported_by.username }}
                    {% else %}
                        <span class="text-muted">Anonymous</span>
                    {% endif %}
                </td>

                <td>
                    {% if report.status == 'new' %}
                        <span class="badge bg-danger">New</span>
                    {% elif report.status == 'reviewed' %}
                        <span class="badge bg-success">Reviewed</span>
                    {% else %}
                        <span class="badge bg-secondary">Dismissed</span>
                    {% endif %}
                </td>

                <td>
                    <form method="POST" action="{% url 'set_report_status' report.pk 'new' %}" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="new">
                        <button class="btn btn-sm btn-danger">New</button>
                    </form>

                    <form method="POST" action="{% url 'set_report_status' report.pk 'reviewed' %}" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="reviewed">
                        <button class="btn btn-sm btn-success">Review</button>
                    </form>

                    <form method="POST" action="{% url 'set_report_status' report.pk 'dismissed' %}" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="status" value="dismissed">
                        <button class="btn btn-sm btn-secondary">Dismiss</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center text-muted">
                    No reports found.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% endblock %}
